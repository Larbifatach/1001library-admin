<ng-template #library_forms let-model let-library_on_loading="library_on_loading" let-library_show_slug="library_show_slug" let-library_submiting="library_submiting" let-library_on_submit="library_on_submit">
  <div class="library__frms">
    <form name="form" autocomplete="off">
      @if (library_errors_msg) {<div class="library__notes"><i class="fi fi-rr-triangle-warning"></i> {{library_errors_msg}}</div>}
      <!-- // -->
      <div class="library__frms-grp library__frms-tgl">
        <label for="is_active">
          {{ 'Is Active' }}
          <input id="is_active" name="is_active" [(ngModel)]="model.is_active" type="checkbox">
          <span class="library__frms-tgl-co"></span>
        </label>
      </div>
      <!-- // -->
      <div class="library__frms-cols lib-start">
        <div class="library__frms-grp">
          <label for="volume">{{ 'Volume' }}</label>
          <input name="volume" id="volume" [(ngModel)]="model.volume" placeholder="{{ 'Volume, EX: 1' }}" type="text">
        </div>
        <div class="library__frms-grp">
          <label for="publishing">{{ 'Publishing' }}</label>
          <input name="publishing" id="publishing" [(ngModel)]="model.publishing" placeholder="{{ 'Publishing, EX: 1990' }}" type="text">
        </div>
        <div class="library__frms-grp">
          <label for="pages">{{ 'Pages' }}</label>
          <input name="pages" id="pages" [(ngModel)]="model.pages" placeholder="{{ 'Pages, EX: 100' }}" type="text">
        </div>
        <div class="library__frms-grp">
          <label for="edition">{{ 'Edition' }}</label>
          <input name="edition" id="edition" [(ngModel)]="model.edition" placeholder="{{ 'Edition, EX: 1' }}" type="text">
        </div>
      </div>
      <!-- // -->
      <div class="library__frms-grp">
        <label for="slug">{{'Slug'}}</label>
        <input name="slug" id="slug" [(ngModel)]="model.slug" placeholder="{{'Slug'}}" type="text" (ngModelChange)="library_edit_record.slug = library_to_slug($event)" required>
      </div>
      <!-- // -->
      <div class="library__frms-acts">
        <button [disabled]="library_on_loading || !model.slug || !model.volume || !model.publishing || !model.pages || !model.edition" type="button" (click)="library_on_submit()">
          <span>@if (!library_on_loading) { <i class="fi fi-rr-check"></i> {{library_submiting}} } @else {<i class="fi fi-rr-rotate-right lib-spin"></i>}</span>
        </button>
      </div>
    </form>
  </div>
</ng-template>
<ng-template #library_temp_edit let-modal> 
  <div class="library__mdl-h">
    <h4><i class="fi fi-rr-pencil"></i> Edit: <strong>{{library_data_record.name_en}}</strong></h4>
    <button class="library__btns lib-circle lib-close" (click)="modal.dismiss()"><i class="fi fi-rr-cross-small"></i></button>
  </div>
  <div class="library__mdl-b">
    <ng-container *ngTemplateOutlet="library_forms; context: { $implicit: library_edit_record,
      library_on_loading: library_load_btns,
      library_show_slug: true,
      library_submiting: 'Update',
      library_on_submit: library_quick_btn.bind(this)
    }"> 
    </ng-container>
  </div>
</ng-template>
<ng-template #library_temp_delete let-modal> <library-deletes
  [library_title]="'Delete'"
  [library_name]="library_data_record.name_en"
  [library_load]="library_load_btns"
  [library_error]="library_errors_msg"
  [library_text]="'Are you sure<br>you want to delete this book?<br>All associated data will be permanently deleted.'"
  (library_close)="modal.dismiss()"
  (library_confirm)="library_delete_record(library_data_record.id, library_index)">
</library-deletes> </ng-template>
<!-- // -->
<ng-template #library_temp_show let-modal> <div class="library__mdl-h"><h4><i class="fi fi-rr-eye"></i> Book: <strong>{{library_data_record.name_en}}</strong></h4><button class="library__btns lib-circle lib-close" (click)="modal.dismiss()"><i class="fi fi-rr-cross-small"></i></button></div>
  <div class="library__mdl-b">
    <div class="library__infos lib-flex-start">
      <div class="library__info">
        <div class="library__info-t"><span><i class="fi fi-rr-book-bookmark"></i> {{ 'Book Card' }}</span></div>
        <div class="library__info-b">
          <ul>
            <li><span>{{ 'Title' }}</span><p>{{library_data_record.name_en}}</p></li>
            <li><span>{{ 'ISBN 10' }}</span><p>{{library_data_record.isbn_10}}</p></li>
            <li><span>{{ 'ISBN 13' }}</span><p>{{library_data_record.isbn_13}}</p></li>
            @if (library_data_record.volume) { <li><span>{{ 'Volume' }}</span><p>{{library_data_record.volume}}</p></li> }
            <li><span>{{ 'Publishing' }}</span><p>{{library_data_record.publishing}}</p></li>
            <li><span>{{ 'Pages' }}</span><p>{{library_data_record.pages}}</p></li>
            <li><span>{{ 'Edition' }}</span><p>{{library_data_record.edition}}</p></li>
          </ul>
        </div>
      </div>
      <div class="library__grids lib-nrml" style="--lib-grids: 1;">
        <div class="library__info">
          <div class="library__info-t"><span><i class="fi fi-rr-folder-open"></i> {{ 'Sub Categories' }}</span></div>
          <div class="library__info-b">
            <ul class="lib-flex">
              @for (cat of library_data_record.sub_categories; track cat.id) {
                <li><span>{{cat.name}}</span></li>
              }
            </ul>
          </div>
        </div>
        <div class="library__info">
          <div class="library__info-t"><span><i class="fi fi-rr-user-pen"></i> {{ 'Authors' }}</span></div>
          <div class="library__info-b">
            <ul class="lib-flex">
              @for (author of library_data_record.authors; track author.id) {
                <li><span>{{author.name}}</span></li>
              }
            </ul>
          </div>
        </div>
        <div class="library__info">
          <div class="library__info-t"><span><i class="fi fi-rr-file-zipper"></i> {{ 'Elemnts' }}</span></div>
          <div class="library__info-b">
            <ul>
              <li><span>{{ 'Year' }}</span><p>{{library_data_record.year.name}}</p></li>
              <li><span>{{ 'Language' }}</span><p>{{library_data_record.lang.name}}</p></li>
              @if (library_data_record.series) { <li><span>{{ 'Series' }}</span><p>{{library_data_record.series.name}}</p></li> }
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
<!-- // -->
<div class="library__main">
  <div class="library__heads">
    <div class="library__heads-t">
      <h1><i class="fi fi-rr-book-bookmark"></i> {{ 'Books' }}</h1>
      <button class="library__btns lib-full" routerLink="/books/add"><i class="fi fi-rr-multiple"></i> {{ 'Add new book' }}</button>
    </div>
    <div class="library__heads-fs library__frms"><div class="library__flex library__heads-f">
      <div class="library__frms-grp lib-wicn_r lib-last">
          <i class="fi fi-rr-book-bookmark"></i>
          <input placeholder="{{'Per name'}}" [(ngModel)]="library_filters['name']" id="library_filter_name" name="library_filter_name" type="text" (keyup.enter)="library_get_filtred()">
      </div>
      <div class="library__frms-grp lib-wicn_r lib-last">
          <i class="fi fi-rr-book-bookmark"></i>
          <input placeholder="{{'Per ISBN 10'}}" [(ngModel)]="library_filters['isbn']" id="library_filter_isbn" name="library_filter_isbn" type="text" (keyup.enter)="library_get_filtred()">
      </div>
      <div class="library__frms-grp lib-wicn_r lib-last lib-frst">
        <i class="fi fi-rr-angle-small-down"></i>
        <select [(ngModel)]="library_filters['status']" id="library_filter_status" name="library_filter_status" (ngModelChange)="library_get_filtred()">
          <option value="">{{'Per status (All)'}}</option>
          <option value="draft">{{'Draft'}}</option>
          <option value="published">{{'Published'}}</option>
        </select>
      </div>
    </div>
    <library-nums [library_model]="library_filters" [library_has_fltr]="library_hasfltr" (library_changed)="library_get_filtred()" (library_clear)="library_rmv_filtred()"></library-nums></div>
  </div>
  <library-cards
    [library_loads]="library_loading"
    [library_total]="library_ttl_posts"
    [library_page]="library_page"
    [library_pages]="library_ttl_pages"
    (library_paginate)="library_pagination($event)" >
    <div class="library__cards">
      @for (record of library_records; track record.id) {
        <div class="library__card">
          <div class="library__card-h library__flex">
            <picture [ngStyle]="{'background-image': `url('${record.cover_url}')`}"></picture>
            <div class="library__card-i">
              <div>
                <div class="library__flex lib-between">
                  <div class="library__flex">
                    <span class="lib-wn"><strong><del>{{record.sub_categories_count}}</del></strong> {{'Categories'}}</span>
                    <span class="lib-wn"><strong><del>{{record.reviews_count}}</del></strong> {{'Reviews'}}</span>
                    <span class="lib-wn"><strong><del>{{record.count_downloads}}</del></strong> {{'Downloads'}}</span>
                  </div>
                  @if (record.is_active) { <span class="published">Published</span> } @else { <span class="draft">Draft</span> }
                </div>
              </div>
              <h1>
                {{record.name_en}} 
                <span class="lib-sku"><b>ISBN 10</b>{{record.isbn_10}}</span>
                @if (record.isbn_13) { <span class="lib-sku"><b>ISBN 13</b>{{record.isbn_13}}</span> }
              </h1>
              <div class="library__flex lib-between">
                <div class="library__flex">
                  <button class="library__btns lib-circle lib-edit" ngbTooltip="{{'Edit'}}" routerLink="/books/edit/{{record.id}}"><i class="fi fi-rr-pencil"></i></button>
                  <button class="library__btns lib-circle lib-close" ngbTooltip="{{'Delete'}}" (click)="library_modal_delete(library_temp_delete, record, $index)"><i class="fi fi-rr-trash"></i></button>
                </div>
                <div class="library__flex">
                  <button class="library__btns lib-circle lib-edit" ngbTooltip="{{'Update'}}" (click)="library_modal_edit(library_temp_edit, record, $index)"><i class="fi fi-rr-file-edit"></i></button>
                  <button class="library__btns lib-circle" ngbTooltip="{{'Preview'}}" (click)="library_modal_show(library_temp_show, record, $index)"><i class="fi fi-rr-eye"></i></button>
                  @if (record.is_active) { <a class="library__btns lib-full" href="https://1001library.com/books/{{record.slug}}" target="_blank"><i class="fi fi-rr-link-alt"></i> {{'Book Page'}}</a> }
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </library-cards>
</div>
<ng-template #library_forms let-model let-library_on_loading="library_on_loading" let-library_submiting="library_submiting" let-library_on_submit="library_on_submit">
  <div class="library__frms">
    <form name="form" autocomplete="off">
        @if (library_errors_msg) {<div class="library__notes"><i class="fi fi-rr-triangle-warning"></i> {{library_errors_msg}}</div>}
        <div class="library__frms-cols lib-three">
            <div class="library__frms-grp">
                <label for="size">Size</label>
                <input id="size" [(ngModel)]="model.size" mask="separator.2" thousandSeparator="," [showMaskTyped]="false" placeholder="Size" name="size" type="text" required>
            </div>
            <div class="library__frms-grp lib-wicn_r lib-last lib-frst">
                <i class="fi fi-rr-angle-small-down"></i>
                <label for="unit">Unit</label>
                <select [(ngModel)]="model.unit" id="unit" name="unit" required>
                    <option value="MB">{{'MB'}}</option>
                    <option value="KB">{{'KB'}}</option>
                </select>
            </div>
            <div class="library__frms-grp lib-wicn_r lib-last lib-frst">
                <i class="fi fi-rr-angle-small-down"></i>
                <label for="extension">Extension</label>
                <select [(ngModel)]="model.extension" id="extension" name="extension" required>
                    <option value="EPUB">{{'EPUB'}}</option>
                    <option value="PDF">{{'PDF'}}</option>
                    <option value="TEXT">{{'TEXT'}}</option>
                </select>
            </div>
        </div>
        <div class="library__frms-grp">
            <label for="download_url">Download Link</label>
            <input id="download_url" [(ngModel)]="model.download_url" placeholder="Link to download" name="download_url" type="text" required>
        </div>
        <div class="library__frms-grp">
            <label for="collection">{{'Uploader'}}</label>
            <library-selects
                library_path="all-uploaders"
                [(library_value)]="model.id_uploader"
                [library_preload]="library_uploaders_preload"
                library_label_key="name"
                [library_is_multi]="false"
                library_value_key="id"
                library_placeholder="{{'Search in uploaders'}}">
            </library-selects>
        </div>
        <div class="library__frms-grp">
            <label for="collection">{{'Book'}}</label>
            <library-selects
                library_path="all-books"
                [(library_value)]="model.id_book"
                [library_preload]="library_books_preload"
                library_label_key="name"
                [library_is_multi]="false"
                library_value_key="id"
                library_placeholder="{{'Search in books'}}">
            </library-selects>
        </div>
        <div class="library__frms-acts">
            <button [disabled]="library_on_loading || !model.size || !model.extension || !model.download_url || !model.id_book || !model.id_uploader" type="button" (click)="library_on_submit()">
            <span>@if (!library_on_loading) { <i class="fi fi-rr-check"></i> {{library_submiting}} } @else {<i class="fi fi-rr-rotate-right lib-spin"></i>}</span>
            </button>
        </div>
    </form>
  </div>
</ng-template>
<!-- // -->
<ng-template #library_temp_create let-modal> <div class="library__mdl-h"><h4><i class="fi fi-rr-multiple"></i> Add new download link</h4><button class="library__btns lib-circle lib-close" (click)="modal.dismiss()"><i class="fi fi-rr-cross-small"></i></button></div>
    <div class="library__mdl-b">
        <ng-container *ngTemplateOutlet="library_forms; context: { $implicit: library_create_record, 
            library_on_loading: library_load_btns,
            library_submiting: 'Create',
            library_on_submit: library_publish_btn.bind(this)
        }"> </ng-container>
    </div>
</ng-template>
<ng-template #library_temp_edit let-modal> <div class="library__mdl-h"><h4><i class="fi fi-rr-pencil"></i> Edit download link of: <strong>{{library_data_record.uploader.name}}</strong></h4><button class="library__btns lib-circle lib-close" (click)="modal.dismiss()"><i class="fi fi-rr-cross-small"></i></button></div>
    <div class="library__mdl-b">
        <ng-container *ngTemplateOutlet="library_forms; context: { $implicit: library_edit_record,
            library_on_loading: library_load_btns,
            library_submiting: 'Update',
            library_on_submit: library_update_btn.bind(this)
        }"> </ng-container>
    </div>
</ng-template>
<ng-template #library_temp_delete let-modal> <library-deletes
    [library_title]="'Delete'"
    [library_name]="library_data_record.name_en"
    [library_load]="library_load_btns"
    [library_error]="library_errors_msg"
    [library_text]="'Are you sure<br>you want to delete this download link?'"
    (library_close)="modal.dismiss()"
    (library_confirm)="library_delete_record(library_data_record.id, library_index)">
</library-deletes> </ng-template>
<!-- // -->
<ng-template #library_temp_show let-modal> <div class="library__mdl-h"><h4><i class="fi fi-rr-eye"></i> Preview download link of: <strong>{{library_data_record.uploader.name}}</strong></h4><button class="library__btns lib-circle lib-close" (click)="modal.dismiss()"><i class="fi fi-rr-cross-small"></i></button></div>
  <div class="library__mdl-b">
    <div class="library__infos lib-flex-start lib-last">
        <div class="library__info">
            <div class="library__info-t"><span><i class="fi fi-rr-user-add"></i> {{ 'Uploader' }}</span></div>
            <div class="library__info-b">
                <ul>
                    <li><span>{{ "Full Name" }}</span><p>{{library_data_record.uploader.name}}</p></li>
                    <li><span>{{ "Email" }}</span><p>{{library_data_record.uploader.email}}</p></li>
                    <li><span>{{ "Balance" }}</span><p>{{ library_data_record.uploader.balance }} <del>{{ "USD" }}</del></p></li>
                    <li><span>{{ "Per Upload" }}</span><p>{{ library_data_record.uploader.much }} <del>{{ "USD" }}</del></p></li>
                    @if (library_data_record.uploader.phone) {  <li><span>{{ "Phone" }}</span><p>{{library_data_record.uploader.phone}}</p></li> }
                </ul>
            </div>
        </div>
        <div class="library__info">
            <div class="library__info-t"><span><i class="fi fi-rr-book-bookmark"></i> {{ 'Book' }}</span></div>
            <div class="library__info-b">
                <ul>
                    <li><span>{{ 'Name' }}</span><p>{{library_data_record.book.name}}</p></li>
                    @if (library_data_record.book.isbn_10) { <li><span>{{ 'ISBN 10' }}</span><p>{{library_data_record.book.isbn_10}}</p></li> }
                    @if (library_data_record.book.isbn_13) { <li><span>{{ 'ISBN 13' }}</span><p>{{library_data_record.book.isbn_13}}</p></li> }
                </ul>
            </div>
        </div>
        <div class="library__info">
            <div class="library__info-t"><span><i class="fi fi-rr-down-to-line"></i> {{ 'Download Link' }}</span></div>
            <div class="library__info-b">
                <ul>
                    <li><span>{{ "Size" }}</span><p>{{library_data_record.size}} {{library_data_record.unit}}</p></li>
                    <li><span>{{ "Extension" }}</span><p>{{library_data_record.extension}}</p></li>
                    <li><span>{{ "Download Url" }}</span><p>{{library_data_record.download_url}}</p></li>
                    <li><span>{{ "Downloads" }}</span><p>{{library_data_record.downloads}}</p></li>
                </ul>
            </div>
        </div>
    </div>
  </div>
</ng-template>
<!-- // -->
<div class="library__main">
    <div class="library__heads">
        <div class="library__heads-t">
            <h1><i class="fi fi-rr-down-to-line"></i> {{ 'Download Links' }}</h1><button class="library__btns lib-full" (click)="library_modal_create(library_temp_create, library_init_record.bind(this))">
            <i class="fi fi-rr-multiple"></i> {{ 'Add new download link' }}</button>
        </div>
        <div class="library__heads-fs library__frms"><div class="library__flex library__heads-f">
            <div class="library__frms-grp lib-wicn_r lib-last lib-id">
                <i class="fi fi-rr-hashtag-lock"></i>
                <input placeholder="{{'ID'}}" [(ngModel)]="library_filters['id']" id="library_filter_id" name="library_filter_id" type="text" (keyup.enter)="library_get_filtred()">
            </div>
            <div class="library__frms-grp lib-wicn_r lib-last">
                <i class="fi fi-rr-book-bookmark"></i>
                <input placeholder="{{'Book name'}}" [(ngModel)]="library_filters['name']" id="library_filter_name" name="library_filter_name" type="text" (keyup.enter)="library_get_filtred()">
            </div>
            <div class="library__frms-grp lib-wicn_r lib-last">
                <i class="fi fi-rr-user-add"></i>
                <input placeholder="{{'Uploader email'}}" [(ngModel)]="library_filters['uploader_email']" id="library_filter_uploader_email" name="library_filter_uploader_email" type="text" (keyup.enter)="library_get_filtred()">
            </div>
            <div class="library__frms-grp lib-wicn_r lib-last lib-frst">
                <i class="fi fi-rr-angle-small-down"></i>
                <select [(ngModel)]="library_filters['extension']" id="library_filter_extension" name="library_filter_extension" (ngModelChange)="library_get_filtred()">
                    <option value="">{{'Extension (All)'}}</option>
                    <option value="EPUB">{{'EPUB'}}</option>
                    <option value="PDF">{{'PDF'}}</option>
                    <option value="TEXT">{{'TEXT'}}</option>
                </select>
            </div>
        </div>
        <library-nums [library_model]="library_filters" [library_has_fltr]="library_hasfltr" (library_changed)="library_get_filtred()" (library_clear)="library_rmv_filtred()"></library-nums></div>
    </div>
    <library-tables
        [library_loads]="library_loading"
        [library_total]="library_ttl_posts"
        [library_page]="library_page"
        [library_pages]="library_ttl_pages"
        (library_paginate)="library_pagination($event)" >
        <div class="library__tbls">
            <div class="library__tbls-h">
                <div class="library__tbls-col library__tbls-col-0">{{'ID'}}</div>
                <div class="library__tbls-col library__tbls-col-1">{{'Size'}}</div>
                <div class="library__tbls-col library__tbls-col-2">{{'Book'}}</div>
                <div class="library__tbls-col library__tbls-col-3">{{"Uploader"}}</div>
                <div class="library__tbls-col library__tbls-col-4">{{"Ext"}}</div>
                <div class="library__tbls-col library__tbls-col-5"></div>
            </div>
            @for (record of library_records; track record.id) {
                <div class="library__tbls-r">
                    <div class="library__tbls-col library__tbls-col-0 library__flex" data-label="ID">
                        <span class="lib-empty">{{record.id}}</span>
                    </div>
                    <div class="library__tbls-col library__tbls-col-1 library__flex" data-label="Size">
                        <span class="lib-empty">{{record.size}} {{record.unit}}</span>
                    </div>
                    <div class="library__tbls-col library__tbls-col-2 library__flex" data-label="Book">
                        <img [src]="record.book.cover_url || '/img/library-cover.jpg'">
                        <h5>{{record.book.name}}</h5>
                    </div>
                    <div class="library__tbls-col library__tbls-col-3 library__flex" data-label="Uploader">
                        <img [src]="record.uploader.avatar_url || '/img/library-avatar.png'">
                        <h5>{{record.uploader.name}}</h5>
                    </div>
                    <div class="library__tbls-col library__tbls-col-4 library__flex" data-label="Extension">
                        <span class="lib-empty">{{record.extension}}</span>
                    </div>
                    <div class="library__tbls-col library__tbls-col-5" data-label="Action">
                        <div class="library__flex lib-last">
                            <button class="library__btns lib-circle" ngbTooltip="{{'Preview'}}" (click)="library_modal_show(library_temp_show, record, $index)"><i class="fi fi-rr-eye"></i></button>
                            <button class="library__btns lib-circle lib-edit" ngbTooltip="{{'Edit'}}" (click)="library_modal_edit(library_temp_edit, record, $index)"><i class="fi fi-rr-pencil"></i></button>
                            <button class="library__btns lib-circle lib-close" ngbTooltip="{{'Delete'}}" (click)="library_modal_delete(library_temp_delete, record, $index)"><i class="fi fi-rr-trash"></i></button>
                        </div>
                    </div>
                </div>
            }
        </div>
    </library-tables>
</div>